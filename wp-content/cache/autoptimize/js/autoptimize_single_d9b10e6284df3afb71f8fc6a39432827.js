jQuery(document).ready(function(){var isCookiesYesAccepted=false;jQuery('.cky-btn-reject').css({position:'absolute',left:'0',border:'none',bottom:'-3px','font-size':'10px'});jQuery('.cky-consent-container .cky-consent-bar').css('padding','10% 24px');jQuery('.cky-btn-reject').text('Reject');window.getCookie=function(name){var match=document.cookie.match(new RegExp('(^| )'+name+'=([^;]+)'));if(match)return match[2];}
function checkIfCookiesYesIsAccepted(){try{getCookie('cookieyes-consent').split(",").forEach(item=>{var keyval=item.split(":");console.log(keyval)
if(keyval[0].indexOf("consent")>-1&&keyval[1]=="yes"){isCookiesYesAccepted=true;}})}
catch(ex){console.log(ex);}
return isCookiesYesAccepted;}
function generateUserID(){var randUniqueNumber='';while(randUniqueNumber.length<15){randUniqueNumber+=Math.floor(Math.random()*10);}
return randUniqueNumber;}
function trackUserJourney(){if(!checkIfCookiesYesIsAccepted())return false;let userID=localStorage.getItem('userID');if(!userID){userID=generateUserID();localStorage.setItem('userID',userID);}
const sessionStartTime=localStorage.getItem('sessionStartTime');if(!sessionStartTime){localStorage.setItem('sessionStartTime',new Date().getTime().toString());}
let visitCount=parseInt(localStorage.getItem('visitCount'))||0;visitCount++;localStorage.setItem('visitCount',visitCount.toString());const referrerURL=document.referrer;localStorage.setItem('referrerURL',referrerURL);const pageVisits=JSON.parse(localStorage.getItem('pageVisits'))||[];const currentPage=window.location.href;const visitTime=new Date().getTime().toString();pageVisits.push({page:currentPage,time:visitTime});localStorage.setItem('pageVisits',JSON.stringify(pageVisits));const trackClickEvent=(event)=>{const clickedElement={tagName:event.target.tagName,className:event.target.className,content:event.target.textContent}
localStorage.setItem("eventClicked",JSON.stringify(clickedElement));console.log('Clicked Element:',clickedElement);sendDataToBackend();};document.addEventListener('click',trackClickEvent);sendDataToBackend();}
function sendDataToBackend(){if(!checkIfCookiesYesIsAccepted())return false;const userID=localStorage.getItem('userID');const sessionStartTime=localStorage.getItem('sessionStartTime');const sessionEndTime=localStorage.getItem('sessionEndTime')
const referrerURL=localStorage.getItem('referrerURL');const pageVisits=JSON.parse(localStorage.getItem('pageVisits'));const visitCount=localStorage.getItem('visitCount');const eventClicked=localStorage.getItem("eventClicked");const trackingData={userID,sessionStartTime,sessionEndTime,referrerURL,pageVisits,visitCount,eventClicked};jQuery.ajax({url:ajax_object.ajax_url,type:'POST',dataType:'json',data:{action:'custom_track_user_journey',trackingData:JSON.stringify(trackingData)},success:function(response){console.log('Tracking data sent successfully');localStorage.removeItem('referrerURL');localStorage.removeItem('eventClicked');},error:function(jqXHR,textStatus,errorThrown){console.error('Error sending tracking data:',errorThrown);}});}
function removeDataFromLocalStorage(){localStorage.setItem('sessionEndTime',new Date().getTime().toString())
sendDataToBackend();localStorage.removeItem('sessionStartTime');localStorage.removeItem('pageVisits');}
window.addEventListener('load',trackUserJourney);window.addEventListener('beforeunload',removeDataFromLocalStorage);})